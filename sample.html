<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title></title>
  <meta name="description" content="">
  <meta name="author" content="">
<style>
    p { 
        text-align: justify;
        text-overflow: clip;
        margin: 0 0 1em 0;
    }
    div#page { 
        position: absolute;
        z-index: 90;
        overflow: hidden;
        border: 1px solid;
    }
    div#page_inner { 
        position: absolute;
        z-index: 91;
        overflow: hidden;
        border: 0;
    }
    div#debug { 
        position: absolute;
        z-index: 91;
        overflow: auto;
        border: 0;
    }
    div.pgButton { 
        position: absolute;
        z-index: 91;
        border: 0;
    }
    div#pgUp:hover {
        background: linear-gradient(90deg, rgba(0,0,0,0.1) 0%, rgba(0,0,0,0) 100%);
    }
    div#pgDown:hover {
        background: linear-gradient(270deg, rgba(0,0,0,0.1) 0%, rgba(0,0,0,0) 100%);
    }
    div#pgUp:active {
        background: linear-gradient(90deg, rgba(0,0,0,0.2) 0%, rgba(0,0,0,0) 100%);
    }
    div#pgDown:active {
        background: linear-gradient(270deg, rgba(0,0,0,0.2) 0%, rgba(0,0,0,0) 100%);
    }
    a#_hide {
        visibility: hidden;
    }
    body {
        background-color: floralwhite;
    }
    
</style>

</head>

<body>
    <label for="file-input" id="fileicon">
        <img src='data:image/svg+xml;utf8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 481.2 481.2" xml:space="preserve"><g><path d="M403.9,97.85h-114c-27.7,0-50.3-22.5-50.3-50.3c0-7.5-6-13.5-13.5-13.5H77.3c-42.6,0-77.3,34.7-77.3,77.3v258.5c0,42.6,34.7,77.3,77.3,77.3h326.6c42.6,0,77.3-34.7,77.3-77.3v-194.8C481.2,132.45,446.5,97.85,403.9,97.85z M454.2,369.75c0,27.7-22.5,50.3-50.3,50.3H77.3c-27.7,0-50.3-22.5-50.3-50.3v-258.4c0-27.7,22.5-50.3,50.3-50.3h136.5c6.4,36.2,38.1,63.8,76.1,63.8h114c27.7,0,50.3,22.5,50.3,50.3L454.2,369.75L454.2,369.75z"/></g></svg>' width="24px">
    </label>
    <input type="file" id="file-input" style="display: none;">
    <div id="page"></div>
    <div id="page_inner"></div>
    <div class="pgButton" id="pgUp"></div>
    <div class="pgButton" id="pgDown"></div>
    <div id="debug"></div>
    
    

<script>
    var text0 = "<div style='text-align:center;color:red;'><p style='text-align:center;'>Lorem ipsum dolor sit amet, sumo legimus sed id, eu mea legere vivendum. Vis lobortis repudiare scribentur id, diceret sanctus omnesque ei eum. Ut inani euripidis definiebas duo. Mei et aliquid quaerendum interpretaris. Pro te alii facete, pro prima percipit ei. Vel ne convenire torquatos, mel eu tantas repudiare sadipscing.</p> </div>" +
"<p> Sed inani feugait scribentur ne, possit epicurei te vel, nonumes elaboraret te pro. Quo ut summo oratio efficiantur, ad mei nulla iusto pericula. Congue tractatos te his, et enim sint ius, iudico corrumpit omittantur qui cu. Usu ne animal nominati contentiones. Ne eos illum voluptatibus, meis aliquam tibique sit id. No per petentium imperdiet expetendis, te cibo autem incorrupte vix. </p>" +
"<p>Ut <i>pro luptatum gloriatur <b>intellegebat. Ne pro dicunt audiam, no dolore</i> indoctum usu. Debet</b> animal mentitum ad est, no alienum petentium adipiscing vel. Cu integre consequat quo, primis iudicabit mel id. Ius ferri ludus mentitum ad, duo ceteros appellantur ei, et usu oratio definitionem. Quo ut alia solum, dicant eripuit quo in.</p> " +
"<p>Noluisse deserunt ut has, convenire consequat an eos. Illum honestatis nam ex, blandit lucilius laboramus ex per. Vix pertinax concludaturque vituperatoribus te, mei ad velit invidunt nominati. Singulis referrentur in qui, ius te malis feugiat, ex ius nulla alterum insolens. Pro veniam eruditi indoctum ut, volumus disputando ut nam. Modus reprehendunt vis an, agam fugit iisque ex pri, in ludus menandri vim.</p> " +
"<p>Pro ei aliquam concludaturque. Sea everti aeterno intellegam cu, no labore officiis cum. Veniam singulis gubergren ea his, ius in nostrud voluptatibus. Elitr inciderint vis cu, ea dicam erroribus vix, vim vocent tacimates suscipiantur cu. Quem dicunt regione ad nam.</p>" +
"<p>Mea id cetero persequeris. Eos et vitae quodsi molestiae, vel alia sententiae accommodare ne, deserunt praesent ea vix. Sed eu sale vulputate, ne altera adolescens cum. Ex sit luptatum incorrupte, brute error invidunt eum eu, bonorum accumsan vulputate ad eos. Id harum alterum appellantur vel, his minimum persequeris ne.</p>" +
"<p>Graeco dignissim an has. Sapientem philosophia vel et, integre constituam cu pro. Mea augue legimus electram in, dicta paulo eum in. Dicam debitis nostrum per ad, eam dicta splendide id, quod timeam liberavisse ei nam. Has ad dicant molestie disputationi. Ne graecis omittam scribentur duo.</p>" +
"<p>Quo rebum consectetuer ne. Mel elitr facete in, nam ex augue vocibus, labore legimus corrumpit vel no. Et cetero aperiam urbanitas duo, quo at quaeque ceteros. At vix simul choro, sea ubique volumus eligendi cu. Mei ad percipit nominati efficiantur, vitae democritum ut has, eam et dolore delenit expetenda. Brute lorem id vix, vis eius clita nostrum an.</p>" +
"<p>No cum tritani facilisi facilisis, eum brute feugait ex, his ad assueverit conclusionemque vituperatoribus. His postea graeco in, vim mundi dolor solet an. Tantas euismod evertitur id mel, his adhuc malis mandamus in. Possit impetus invidunt et pri, quo ne alterum sanctus, at eam mucius option equidem.</p>" +
"<p>An cum fastidii scripserit, ne vix ferri iracundia, sit et meis inani. Aperiam delenit ei sea, ius cibo veniam no, per vero impedit ex. Eum id iudico facilis, enim voluptua ut qui. Melius latine mei te, te summo affert consectetuer has. Exerci fastidii conceptam cu mel, expetenda disputando ea nec. Ex vim ridens senserit, id docendi reformidans sit, id est eruditi reprehendunt.</p>";
    var Page = document.getElementById("page_inner");
    var Page0 = document.getElementById("page");
    var Debug = document.getElementById("debug");
    var PgUp = document.getElementById("pgUp");
    var PgDown = document.getElementById("pgDown");
    var pageBottom;
    var ratio = 1.5;
    var marginTop = 1;
    var marginBottom = 80;
    var marginLeft = 100;
    var marginRight = 100;
    var paddingTop = 20;
    var paddingBottom = 20;
    var paddingLeft = 40;
    var paddingRight = 40;
    
    var words;
    var pageSize = 0;
    var offWord = 0;
    var nxtPage;
    var pageStart = new Array();
    var currentPage = 0;
    var pageCenter = 0;
    
    function readSingleFile(e) {
        var file = e.target.files[0];
        if (!file) {
            return;
        }
        var reader = new FileReader();
        reader.onload = function(e) {
            text0 = e.target.result;
            runReader();
        }
        reader.readAsText(file);
    }
     
    function setUpPage() {
        var width = document.documentElement.clientWidth;
        var height = document.documentElement.clientHeight;
        var x, y, dx, dy, x0, y0, dx0, dy0;
        var textOut;
        
        dx0 = width - marginLeft - marginRight;
        dy0 = height - marginTop - marginBottom;
        x0 = marginLeft;
        y0 = marginTop;


/*        if(dy0 > dx0 * ratio ) {
            dy0 = Math.round(dx0 * ratio);
            y0 = marginTop +
                Math.floor((height -
                    dy0 - marginTop - marginBottom) / 2);
        }
        else {
            dx0 = Math.round(dy0 / ratio);
            x0 = marginLeft +
                Math.floor((width -
                    dx0 - marginLeft - marginRight) / 2);
        } */
        x = x0 + paddingLeft;
        y = y0 + paddingTop;
        dx = dx0 - paddingLeft - paddingRight;
        dy = dy0 - paddingTop - paddingBottom;
        
        Page0.style.width = dx0 + "px";
        Page0.style.minHeight = Page0.style.maxHeight = dy0 + "px";
        Page0.style.left = x0 + "px";
        Page0.style.top = y0 + "px";
  
        Page.style.width = dx + "px";
        Page.style.left = x + "px";
        Page.style.top = y + "px";
        pageBottom = y + dy;

        Debug.style.width =
            width - 60 + "px";
        Debug.style.minHeight =
        Debug.style.maxHeight =
            height - y0 - dy0 - 20 + "px";
        Debug.style.left = "30px";
        Debug.style.top =
            y0 + dy0 + 10 + "px";
        
        PgUp.style.width = paddingLeft - 5 + "px";
        PgUp.style.height = dy0 + "px";
        PgUp.style.left = x0 + 1 + "px";
        PgUp.style.top = y0 + 1 + "px";
        
        PgDown.style.width = paddingRight - 5 + "px";
        PgDown.style.height = dy0 + "px";
        PgDown.style.left = x + dx + 5 + "px";
        PgDown.style.top = y0 + 1 + "px";
        
        if(pageCenter == 0)
            pageCenter = (offWord + nxtPage) >> 1;
        if(offWord > 0) {
            var find = pageCenter;
            offWord = 0; currentPage = 0;
            outputClipped();
            while(nxtPage < find) nextPage();
            pageCenter = find;
        }
        else outputClipped();
        
    }
    
    var TextFrame = function(name) {
        var id = name;
        return {
            name: id;
        }
    }
    
    var FindWords = function(text) {
        var starts = new Array();
        var ends = new Array();
        var formats = new Array();
        var i = 0, n = 0;
        var space = true, tag = false;
        var opentags = 0, formatStart = 0;
        
        for(i = 0; i < text.length; i++) {
            var c = text.charAt(i);
            
            if(c == '<') {
                i++; c = text.charAt(i);
                
                if(c == '/') {
                    if(!space) {
                        if(text.charAt(i + 1) == 'p' &&
                            text.charAt(i + 2) == '>') {
                                ends[n] = i - 1;
                                space = true;
                                n++;
                        }
                    }   // </p> means end of word
                    opentags--;
                }   // closing tag
                else {
                    if(opentags == 0) {
                        formatStart = i - 1;
                    }
                    opentags++;
                }   // opening tag
                
                do {
                    i++; c = text.charAt(i);
                    if(c == '/')
                        if(text.charAt(i + 1) == '>')
                            opentags--;
                } while(c != '>');
            }   // tag processing
            
            else {
                if(c == ' ' || c == '—' || c == '-' || c == '\r' || c == '\n') {
                    if(!space) {
                        ends[n] = i;
                        space = true;
                        n++;
                    }
                }
                else {
                    if(space) {
                        starts[n] = i;
                        formats[n] = formatStart;
                        space = false;
                    }
                }
            }   // not a tag, process words and spaces
        }
        
        return {
            start: starts,
            end: ends,
            format: formats,
            length: n
        }
    }
        
    function outputClipped() {
        var step = 256, rect;
        if(pageSize > 0) step = pageSize;

        var first = offWord, last = offWord + step;
        while(isWordVisible(last)) {
            first = last; last += step;
        }
        if(last > words.length) last = words.length;
        while(last - first > 1) {
            step = (last - first) >> 1;
            var i = first + step;
            if(isWordVisible(i))
                first = i;
            else last = i;
        }
        trimTextBy(last);
        pageSize = last - offWord;
        nxtPage = last;
    }

    function isWordVisible(i) {
        if(i >= words.length) return false;
        trimTextBy(i);
        if(document.getElementById("_hide").
            getBoundingClientRect().bottom < pageBottom) return true;
        return false;
    }
    
    function trimTextBy(word) {
        
        var text = "<a style='display:none;'>" +
            text0.substring(words.format[offWord],words.start[offWord]) +
            "</a>";
        if(word < words.length) {
            text += text0.substring(words.start[offWord],words.start[word]) +
                "<a id='_hide'>" +
                text0.substring(words.start[word], words.end[word]) +
                "</a>";
        }
        else text += text0.substring(words.start[offWord]);
        
        Page.innerHTML = text;
    }
    
    function nextPage() {
        if(nxtPage >= words.length) return;
        pageStart[currentPage] = offWord;
        currentPage++;
        offWord = nxtPage;
        outputClipped();
        pageCenter = (offWord + nxtPage) >> 1;
    }
    
    function prevPage() {
        if(offWord == 0) return;
        currentPage--;
        offWord = pageStart[currentPage];
        outputClipped();
        pageCenter = (offWord + nxtPage) >> 1;
    }

    function runReader() {
        document.getElementById('fileicon').style.display = 'none';
        words = new FindWords(text0);
        
        var sheet = document.createElement('style');
        sheet.innerHTML = "p.test { font-size:12pt; }";
        document.body.appendChild(sheet);
        
        setUpPage();
        
        window.addEventListener("resize", setUpPage);
        PgDown.addEventListener("click", nextPage);
        PgUp.addEventListener("click", prevPage);
        
        var testing = new TextFrame();
        Debug.innerHTML = testing.name;
        
        
    }
    
    function changeFontSize(size) {
        
    }
    
    document.getElementById('file-input').addEventListener('change', readSingleFile, false);
    
    
    
</script>
    
    
    </body>
</html>